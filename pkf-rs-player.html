<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Play on Flash in Rust</title>
        <style>
            body{
                background: #111;
                color: #eee;
                font-family: monospace;
            }
            #hjk {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            a{
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <div id="hjk">
            <div id="hkjhkjh">
                <a id="clickswfe">SWF Example</a>
                <label>or</label>
                <a id="gdffdgdg">Open .swf</a>
                <label id="swftitle"></label>
                <p id="loading-state"></p>
                <div id="swfeArea"></div>
            </div>
            <div id="playerArea"></div>    
        </div>
        <script>
        </script>
        <script>
            var SWFE = function(datas, f) {
                var dataG = JSON.parse(JSON.stringify(datas));
                this.root = document.createElement('div');
                this._di = document.createElement('div');
                this.root.appendChild(this._di);
                this.list = document.createElement('div');
                this.root.appendChild(this.list);
                this.list.style.width = "550px";
                this.list.style.height = "250px";
                this.list.style.overflow = "auto";
                this.elements = [];
                var result = [];
                for (var i = 0; i < dataG.length; i++) {
                    var data = dataG[i];
                    if (data.md5 && data.thumb) if (!f || (data.metadata.indexOf(f) >= 0)) {
                        data.thumb_id = (1000000 + (Math.random() * 9000000)) | 0;
                        result.push(data);
                    }
                }
                this.images = {};
                this.datas = result;
                this.onclick = null;
                this.isload = false;
            }
            SWFE.prototype.load = function() {
                var _this = this;
                if (this.isload) return;
                this.isload = true;
                var dfg = Math.ceil(this.datas.length / 20);
                for (var i = 0; i < dfg; i++) {
                    var r = document.createElement('button');
                    r.textContent = i + 1;
                    r.onclick = (function(_) {
                        return function() {
                            _this.loadElements(_);
                        }
                    }(i * 20));
                    this._di.appendChild(r);
                }
                this.loadElements(0);
            };
            SWFE.prototype.loadElements = function(a) {
                while (this.elements.length) {
                    var elem = this.elements.pop();
                    this.list.removeChild(elem);
                }
                for (var i = 0; i < 20; i++) {
                    var data = this.datas[i + a];
                    if (data) {
                        var elem = this.loadElement(data);
                        this.elements.push(elem);
                        this.list.appendChild(elem);
                    }
                }
            }
            SWFE.prototype.loadElement = function(data) {
                var _this = this;
                var elem = document.createElement('div');
                elem.style.width = "108px";
                elem.style.height = "100px";
                elem.style.overflow = "hidden";
                elem.style.float = "left";
                elem.style.margin = "5px";
                elem.style.padding = "5px";
                elem.style.cursor = "pointer";
                elem.style.border = "2px solid #fff";
                var img = document.createElement('img');
                img.width = 108;
                img.height = 80;
                img.title = data.metadata;
                if (data.thumb_id in _this.images) {
                    if (_this.images[data.thumb_id]) img.src = URL.createObjectURL(_this.images[data.thumb_id]);
                } else {
                    _this.images[data.thumb_id] = null;
                    fetch("https://assets.scratch.mit.edu/internalapi/asset/" + data.thumb + "/get/").then(function(e) {
                        e.blob().then(function(a) {
                            _this.images[data.thumb_id] = a;
                            img.src = URL.createObjectURL(a);
                        });
                    }); 
                }
                elem.appendChild(img);
                elem.onclick = function() {
                    if (_this.onclick) {
                        _this.onclick(data);
                    }   
                }
                var _title = document.createElement('label');
                _title.textContent = data.name;
                elem.appendChild(_title);
                return elem;
            };
            var ATFSMediaStudio_PKF_LOADER = (function() {const ZLib=(function() {const A = {key: new Uint16Array([5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]), value: new Uint16Array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31])}, S = {key: new Uint16Array([7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9]), value: new Uint16Array([256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 280, 281, 282, 283, 284, 285, 286, 287, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255])};const Q = new Uint8Array([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]), W = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 99, 99]), E = new Uint16Array([3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0]), R = new Uint8Array([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13]), T = new Uint16Array([1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577]);class B {constructor(_, a = 0, b = 0) {this.data = _, this.byte_offset = a, this.bit_offset = b, this.bit_buffer = null} readSubArray(n) {var a = this.data.subarray(this.byte_offset, this.byte_offset + n); return this.byte_offset += n, a;} readUint8() {return this.data[this.byte_offset++]} readUint16be() {var a = (this.data[this.byte_offset + 1] << 8) + this.data[this.byte_offset]; return this.byte_offset += 2, a} readUB(n) {let z = 0; for (let i = 0; i < n; i++) {if (this.bit_offset === 8) this.bit_buffer = this.data[this.byte_offset++], this.bit_offset = 0;z |= (this.bit_buffer & (1 << this.bit_offset++) ? 1 : 0) << i};return z}};const D = function (_) {let r = Math.max.apply(null, _);const p = _.length, c = new Uint8Array(r);let i = p, j = 0;while (i--) j = _[i], c[j] += (j > 0);let m = 0, o = 0;const g = new Uint16Array(r + 1);for (i = 0; i < r; ) m = (m + c[i++]) << 1, g[i] = m | 0, o = Math.max(o, m);const n = o + p, k = new Uint16Array(n), v = new Uint16Array(n);for (i = 0; i < p; i++) {if (j = _[i], j) {const u = g[j]; k[u] = j, v[u] = i, g[j] = (u + 1) | 0}};return {key: k, value: v}};const F = function (x, y, z) {let a = 0, b = 0;while (true) {b = (b << 1) | x.readUB(1); a++; if (y[b] === a) return z[b];}};return {decompress: function (_, n, v) {var a = v || 0; const o = new Uint8Array(n), br = new B(new Uint8Array(_), a + 2, 8), h = new Uint8Array(19); var y = 0, i = 0, b = 0, f = 0; while (!f) {f = br.readUB(1); let u = br.readUB(2), j = null, l = null; switch (u) {case 0: br.bit_offset = 8, br.bit_buffer = null, b = br.readUint16be(), br.byte_offset += 2, o.set(br.readSubArray(b), a), a += b; break; default: switch (u) {case 1: j = A, l = S; break; default: const q = br.readUB(5) + 257, w = br.readUB(5) + 1, e = br.readUB(4) + 4; for (i = 0; i < e; i++) h[Q[i]] = br.readUB(3); const s = D(h); h.fill(0); const c = q + w, d = new Uint8Array(c); let z = 0, t = 0; while (t < c) {y = F(br, s.key, s.value);switch (y) {case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7: case 8: case 9: case 10: case 11: case 12: case 13: case 14: case 15: d[t++] = y, z = y; break; case 16: i = br.readUB(2) + 3, d.fill(z, t, t + i), t += i; break; case 17: i = br.readUB(3) + 3, t += i; break; case 18: i = br.readUB(7) + 11, t += i; break;}};j = D(d.subarray(q)), l = D(d.subarray(0, q))};y = 0;while (true) {if (y = 0 | F(br, l.key, l.value), 256 === y) break;if (y < 256) {o[a++] = y} else {const z = (y - 257) | 0; b = (E[z] + br.readUB(W[z])) | 0; const x = F(br, j.key, j.value); i = (a - ((T[x] + br.readUB(R[x])) | 0)) | 0; while (b--) o[a++] = o[i++];}}}} return o.buffer}}}());var G = function() {};G.loadMd5WithZlib = function(md5, type, callback) {var xhr = new XMLHttpRequest();xhr.onload = function () {var s=xhr.response.slice(0x2c);var m=new DataView(s);var r=m.getUint32(0,true);var o=ZLib.decompress(s.slice(4),r);var b=new Blob([new Uint8Array(o)],{type: type});var r=new FileReader();r.onload=function(e){callback(e.target.result)};r.readAsDataURL(b)};xhr.onerror = function () {callback(null)};xhr.responseType = "arraybuffer";xhr.open("GET", "https://assets.scratch.mit.edu/internalapi/asset/" + md5 + ".wav/get/");xhr.send()};G.load = function(func) {G.loadMd5WithZlib("81a4deb8f063c207d7f75cc40319ff85", "application/wasm", function(a) {G.loadMd5WithZlib("a38cb8c7507bad3f7769d85361d9e802", "application/wasm", function(s) {G.loadMd5WithZlib("7e74f1abf16d5ba5eab1cf287ce538d6", "application/javascript", function(d) {G.loadMd5WithZlib("2e5263a95855c48727325c588f68d916", "application/javascript", function(f) {G.loadMd5WithZlib("453a79acf74deb8a4dd8f1ee652503ef", "application/javascript", function(g) {var q = "data:application/javascript;base64,";var w = new Function("ASSETS", atob(g.slice(q.length)));w({data1: a,data2: s,datas: {"core.ruffle.e1ab5671fe9d69a41e55.js": d,"core.ruffle.f89dddb9f2e76e2d314e.js": f}});func()})})})})})};return G}());
            var loadingState = document.getElementById("loading-state");
            function main() {
                var swfeArea = document.getElementById('swfeArea');
                var playerArea = document.getElementById('playerArea');
                var clickswfe = document.getElementById('clickswfe');
                var sef = new SWFE(pinkfieSampleSWF);
                sef.root.style.display = "none";
                swfeArea.appendChild(sef.root);

                clickswfe.onclick = function() {
                    if (sef.root.style.display == "none") {
                        sef.root.style.display = "";
                        sef.load();
                    } else {
                        sef.root.style.display = "none";
                    }
                }
                loadingState.style.display = "none";
                loadingState.textContent = "";
                var player = RufflePlayer.sources.local.createPlayer();
                playerArea.appendChild(player);
                var gdffdgdg = document.getElementById("gdffdgdg");
                var swftitle = document.getElementById("swftitle");
                gdffdgdg.onclick = function() {
                    var sa = document.createElement('input');
                    sa.type = 'file';
                    sa.accept = '.swf';
                    sa.addEventListener('change', function(e) {
                        var file = e.target.files[0];
                        if (!file)
                            return;
                        swftitle.textContent = file.name;
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            var data = e.target.result;
                            sef.root.style.display = "none";
                            player.load({
                                url: data,
                            });
                        }
                        ;
                        reader.readAsDataURL(file);
                    }, false);
                    sa.click();
                }
                function fetchSwfMd5(md5, callback, callbackProgress) {
                    var xhr = new XMLHttpRequest();
                    xhr.onload = function () {
                        callback(new Uint8Array(xhr.response.slice(0x2c)));
                    };
                    xhr.onprogress = function (e) {
                        if (callbackProgress) callbackProgress(e.loaded / e.total);
                    };
                    xhr.onerror = function () {
                        callback(null);
                    };
                    xhr.responseType = "arraybuffer";
                    xhr.open("GET", "https://assets.scratch.mit.edu/internalapi/asset/" + md5 + ".wav/get/");
                    xhr.send();
                }
                function fetchSwfUrl(url, callback, callbackProgress) {
                    var xhr = new XMLHttpRequest();
                    if (Array.isArray(url)) {
                        var result = [];
                        var id_md5 = 0;
                        function _excgfd() {
                            if (result.length > 1) {
                                var len = 0;
                                for (var i = 0; i < result.length; i++) {
                                    len += result[i].length;
                                }
                                var res = new Uint8Array(len);
                                var offest = 0;
                                for (var i = 0; i < result.length; i++) {
                                    res.set(result[i], offest);
                                    offest += result[i].length;
                                }
                                callback(new Blob([res]), null);
                            } else {
                                callback(new Blob([result[0]]), null);
                            }
                        }
                        function _next() {
                            fetchSwfMd5(url[id_md5], function(res) {
                                if (!res) {
                                    callback(null, "failed md5");
                                    return;
                                }
                                id_md5++;
                                result.push(res);
                                if (id_md5 >= url.length) {
                                    _excgfd();
                                } else {
                                    _next();
                                }
                            }, function(_p) {
                                if (callbackProgress) callbackProgress((id_md5 / url.length) + (_p / url.length));
                            });
                        }
                        _next();
                    } else {
                        xhr.onload = function () {
                            if (xhr.status !== 200) {
                                callback(null, xhr.status || xhr.statusText);
                            } else {
                                var dat = new Uint8Array(xhr.response);
                                callback(new Blob([dat]), null);
                            }
                        };
                        xhr.onprogress = function (e) {
                            if (callbackProgress) callbackProgress(e.loaded / e.total);
                        };
                        xhr.onerror = function () {
                            callback(null, "unknown");
                        };
                        xhr.responseType = "arraybuffer";
                        xhr.open("GET", url);
                        xhr.send();
                    }
                }
                function loadSwfURL(array) {
                    swftitle.textContent = "";
                    loadingState.style.display = "";
                    loadingState.innerHTML = "loading swf url";
                    fetchSwfUrl(array, function(b) { 
                        if (b) {
                            loadingState.style.display = "none";
                            loadingState.innerHTML = "";
                            var r = new FileReader();
                            r.onload = function(e) {
                                player.load({
                                    url: e.target.result
                                });
                            }
                            r.readAsDataURL(b);
                        } else {
                            loadingState.style.display = "none";
                            loadingState.innerHTML = "";
                        }
                    }, function(e) {
                        loadingState.innerHTML = "loading swf url " + Math.round(e * 100) + "%";
                    })
                }
                function loadSampleSWF(infoSample) {
                    var name = infoSample.name;
                    if (infoSample.md5) {
                        loadSwfURL(infoSample.md5.split("_"));
                    }
                    document.title = name;
                }
                sef.root.style.display = "";
                sef.load();
                sef.onclick = function(gd) {
                    loadSampleSWF(gd);
                }
                loadSwfURL(["a2622ba981d57f4bc9f555d2890cf1e1"]); // 7e217e68a3ff253f58fe0e577bdbe4b1
                // 3da8202dabd6185e6f51a35b18caed4d 2fbad50a333e448cfa010eb7bd1c538b
                // 
                // 7e217e68a3ff253f58fe0e577bdbe4b1
            }
            loadingState.textContent = "Loading SWF Samples";
            var xhr = new XMLHttpRequest();
            xhr.onload = function () {
                var g = new Uint8Array(xhr.response.slice(0x2c));
                var t = new TextDecoder().decode(g);
                window.pinkfieSampleSWF = JSON.parse(t.slice(24, t.length - 1));
                loadingState.textContent = "Loading WASM Data";
                ATFSMediaStudio_PKF_LOADER.load(main);
            };
            xhr.responseType = "arraybuffer";
            xhr.open("GET", "https://assets.scratch.mit.edu/internalapi/asset/29d082724dbc580f3ea44a102c1122f7.wav/get/");
            xhr.send();
        </script>
    </body>
</html>